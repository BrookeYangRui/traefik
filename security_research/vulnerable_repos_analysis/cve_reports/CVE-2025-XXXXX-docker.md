# CVE-2025-XXXXX: Forward Auth Header Injection in Artiume/docker Traefik Configuration

## 基本信息

- **CVE ID**: CVE-2025-XXXXX (待分配)
- **项目**: Artiume/docker
- **发现日期**: 2025-12-28
- **报告者**: Security Research
- **严重程度**: High (CVSS 7.5)
- **项目星级**: 64 stars

## 漏洞描述

Artiume/docker 项目中的多个 Traefik Forward Auth 中间件配置存在 HTTP Header Injection 漏洞。多个 Docker Compose 文件中都设置了 `trustForwardHeader: true` 但没有配置 `trustedIPs` 白名单，导致 Traefik 信任所有来源的 X-Forwarded-* 头并转发到认证服务。

## 受影响文件

多个文件都受影响，包括：
- `ubooquity.yml`
- `nextcloud.yml`
- `radarr.yml`
- `portainer.yml`
- `traefik-SSO.yml`
- `picard.yml`
- `mariadb+pma.yml`
- `sabnzbd.yml`
- `traefik-auth.yml`
- `sonarr.yml`
- `netdata.yml`
- `nzbhydra2.yml`
- `lidarr.yml`
- `firefox.yml`
- `jackett.yml`
- `irc-lounge.yml`
- `bazarr.yml`
- `autoindex.yml`
- `bitwarden.yml`
- `heimdall.yml`

## 漏洞配置

所有受影响文件都包含类似的配置：

```yaml
labels:
  - "traefik.frontend.auth.forward.trustForwardHeader=true"
  # 或
  - "traefik.http.middlewares.xxx.forwardauth.trustForwardHeader=true"
```

## 漏洞详情

### 问题分析

1. **配置问题**: 20+ 个服务都配置了 `trustForwardHeader: true` 且**没有配置 trustedIPs**
2. **影响**: Traefik 会信任**所有来源**的 X-Forwarded-* 头并转发到认证服务
3. **攻击向量**: 攻击者可以直接向 Traefik 发送恶意请求
4. **影响范围**: 20+ 个服务受影响

### 攻击场景

同 CVE-2025-XXXXX-traefik-crowdsec-bouncer

## 影响评估

### CVSS 3.1 评分

- **Base Score**: 7.5 (High)
- **Vector**: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:L/I:L/A:N

### 实际影响

1. **日志注入** ✅ **几乎肯定发生**
2. **IP 欺骗** ✅ **很可能发生**
3. **认证绕过** ⚠️ **可能发生**
4. **影响范围大** - 20+ 个服务受影响

## 威胁模型

同 CVE-2025-XXXXX-traefik-crowdsec-bouncer

## 修复建议

### 方案 1: 移除 trustForwardHeader 配置（推荐）

在所有受影响文件中移除 `trustForwardHeader: true` 配置。

### 方案 2: 配置 trustedIPs 白名单

需要在 Traefik 的全局配置中设置 trustedIPs。

## 备注

这是实际项目配置，20+ 个服务都受影响，攻击面大。建议尽快修复所有受影响的服务。

